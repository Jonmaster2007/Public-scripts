
-- –ò–≥—Ä–æ–∫ –∏ —á–∞—Å—Ç–∏
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Å–∏–ª—ã
local velocity = Instance.new("BodyVelocity")
velocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
velocity.P = 1e5

local gyro = Instance.new("BodyGyro")
gyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
gyro.P = 1e5

-- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
local flying = false
local baseSpeed = 20
local currentSpeed = baseSpeed
local acceleration = 10
local deceleration = 5
local maxSpeed = 100

local direction = {
    forward = false,
    backward = false,
    left = false,
    right = false,
    up = false,
    down = false
}

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∞–≤–∏—à
UIS.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if input.KeyCode == Enum.KeyCode.W then direction.forward = true end
    if input.KeyCode == Enum.KeyCode.S then direction.backward = true end
    if input.KeyCode == Enum.KeyCode.A then direction.left = true end
    if input.KeyCode == Enum.KeyCode.D then direction.right = true end
    if input.KeyCode == Enum.KeyCode.Space then direction.up = true end
    if input.KeyCode == Enum.KeyCode.LeftControl then direction.down = true end
end)

UIS.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.W then direction.forward = false end
    if input.KeyCode == Enum.KeyCode.S then direction.backward = false end
    if input.KeyCode == Enum.KeyCode.A then direction.left = false end
    if input.KeyCode == Enum.KeyCode.D then direction.right = false end
    if input.KeyCode == Enum.KeyCode.Space then direction.up = false end
    if input.KeyCode == Enum.KeyCode.LeftControl then direction.down = false end
end)

-- üü¢ Rayfield Keybind
local LocalPlayer = Players.LocalPlayer

local flying = false
local baseSpeed, maxSpeed, acceleration, deceleration = 5, 50, 2, 1
local currentSpeed = baseSpeed

local direction = {
    forward = false, backward = false,
    left = false, right = false,
    up = false, down = false
}

local rootPart, humanoid, velocity, gyro

local function setupCharacter(char)
    humanoid = char:WaitForChild("Humanoid")
    rootPart = char:WaitForChild("HumanoidRootPart")

    velocity = Instance.new("BodyVelocity")
    velocity.MaxForce = Vector3.new(1, 1, 1) * 1e5
    velocity.Velocity = Vector3.zero

    gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(1, 1, 1) * 1e5
    gyro.P = 1e4
end

-- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ —Ä–µ—Å–ø–∞–≤–Ω–∞
LocalPlayer.CharacterAdded:Connect(setupCharacter)
if LocalPlayer.Character then
    setupCharacter(LocalPlayer.Character)
end

-- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—ë—Ç–∞ —á–µ—Ä–µ–∑ –∫–µ–π–±–∏–Ω–¥
local Keybind = KTab:CreateKeybind({
    Name = "Fly Keybind",
    CurrentKeybind = "Insert",
    HoldToInteract = false,
    Flag = "FlyKeybind",
    Callback = function()
        flying = not flying

        if flying and rootPart and humanoid then
            humanoid.PlatformStand = true
            currentSpeed = baseSpeed

            velocity.Parent = rootPart
            gyro.Parent = rootPart

            RunService:BindToRenderStep("FlyControl", Enum.RenderPriority.Character.Value, function()
                local cam = workspace.CurrentCamera
                local move = Vector3.zero

                if direction.forward then move += cam.CFrame.LookVector end
                if direction.backward then move -= cam.CFrame.LookVector end
                if direction.left then move -= cam.CFrame.RightVector end
                if direction.right then move += cam.CFrame.RightVector end
                if direction.up then move += cam.CFrame.UpVector end
                if direction.down then move -= cam.CFrame.UpVector end

                if move.Magnitude > 0 then
                    currentSpeed = direction.forward and math.min(currentSpeed + acceleration, maxSpeed)
                        or math.max(currentSpeed - deceleration, baseSpeed)
                    velocity.Velocity = move.Unit * currentSpeed
                else
                    velocity.Velocity = Vector3.zero
                    currentSpeed = math.max(currentSpeed - deceleration, baseSpeed)
                end

                gyro.CFrame = cam.CFrame
            end)
        else
            if humanoid then humanoid.PlatformStand = false end
            if velocity then velocity.Parent = nil end
            if gyro then gyro.Parent = nil end
            RunService:UnbindFromRenderStep("FlyControl")
        end
    end
})

-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard then
        local code = input.KeyCode
        if code == Enum.KeyCode.W then direction.forward = true end
        if code == Enum.KeyCode.S then direction.backward = true end
        if code == Enum.KeyCode.A then direction.left = true end
        if code == Enum.KeyCode.D then direction.right = true end
        if code == Enum.KeyCode.Space then direction.up = true end
        if code == Enum.KeyCode.LeftControl then direction.down = true end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        local code = input.KeyCode
        if code == Enum.KeyCode.W then direction.forward = false end
        if code == Enum.KeyCode.S then direction.backward = false end
        if code == Enum.KeyCode.A then direction.left = false end
        if code == Enum.KeyCode.D then direction.right = false end
        if code == Enum.KeyCode.Space then direction.up = false end
        if code == Enum.KeyCode.LeftControl then direction.down = false end
    end
end)
