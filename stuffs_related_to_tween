-- ======= TELEPORT TO SPECIFIC NPCS =======
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- Utility: check if a model is a valid NPC
local function isValidNPC(model)
    if not model or not model:IsA("Model") then return false end
    if Players:GetPlayerFromCharacter(model) then return false end
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health > 0
end

-- Get all NPCs in the workspace
local function getAllNPCs()
    local npcs = {}
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and isValidNPC(obj) then
            table.insert(npcs, obj)
        end
    end
    return npcs
end

-- Find nearest NPC by name (ignores vertical distance)
local function findNearestNPCByName(npcName)
    local nearest
    local playerChar = LocalPlayer.Character
    local playerRoot = playerChar and playerChar:FindFirstChild("HumanoidRootPart")
    if not playerRoot then return nil end

    local playerPos2D = Vector2.new(playerRoot.Position.X, playerRoot.Position.Z)

    for _, npc in ipairs(getAllNPCs()) do
        if string.lower(npc.Name) == npcName:lower() then
            local root = npc:FindFirstChild("HumanoidRootPart")
            if root then
                local npcPos2D = Vector2.new(root.Position.X, root.Position.Z)
                local dist = (npcPos2D - playerPos2D).Magnitude
                if not nearest or dist < (Vector2.new(nearest.Position.X, nearest.Position.Z) - playerPos2D).Magnitude then
                    nearest = root
                end
            end
        end
    end

    return nearest
end
