-- =====================================================
--  UNIVERSAL WAYPOINT TWEEN FUNCTION (Safe Tween)
--  ✔ FULL 3D MOVEMENT (no more forced horizontal)
-- =====================================================

-- Your defaults (only applied once when script loads)
getgenv().antiDamageEnabled = (getgenv().antiDamageEnabled ~= nil) and getgenv().antiDamageEnabled or true
getgenv().blockRagdoll = (getgenv().blockRagdoll ~= nil) and getgenv().blockRagdoll or false

getgenv().TweenToPosition = function(positionVector3)
    local Players = game:GetService("Players")
    local TweenService = game:GetService("TweenService")
    local player = Players.LocalPlayer
    if not player then return end

    local char = player.Character
    if not char then
        warn("TweenToPosition: character not loaded yet")
        return
    end

    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then
        warn("TweenToPosition: HumanoidRootPart not found")
        return
    end

    if typeof(positionVector3) ~= "Vector3" then
        warn("TweenToPosition: invalid Vector3")
        return
    end

    -- Distance → duration
    local distance = (positionVector3 - root.Position).Magnitude
    local TIME_PER_STUD = 1 / 150
    local duration = math.clamp(distance * TIME_PER_STUD, 0.1, 10)

    -- Save BOTH user settings
    local originalRagdollState = getgenv().blockRagdoll
    local originalAntiDmgState = getgenv().antiDamageEnabled

    -- Force protection ON during teleport
    getgenv().blockRagdoll = true
    getgenv().antiDamageEnabled = true

    -- Tween
    local tween = TweenService:Create(
        root,
        TweenInfo.new(duration, Enum.EasingStyle.Linear),
        {CFrame = CFrame.new(positionVector3)}
    )
    tween:Play()

    tween.Completed:Connect(function()
        task.delay(1, function()
            -- Restore the user's settings after 1 second
            getgenv().blockRagdoll = originalRagdollState
            getgenv().antiDamageEnabled = originalAntiDmgState
        end)
    end)
end


